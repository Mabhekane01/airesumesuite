version: '3.8'

# Cloud Deployment Configuration
# This configuration is optimized for cloud platforms like Railway, Render, or DigitalOcean
# Uses external MongoDB Atlas and Redis Cloud (no local database containers)

services:
  # Backend API - Cloud Deployment
  backend:
    build:
      context: .
      dockerfile: ./apps/backend/Dockerfile
      target: production
    container_name: ai-job-suite-backend-cloud
    restart: unless-stopped
    ports:
      - "${PORT:-3001}:3001"
    environment:
      # Application Settings
      - NODE_ENV=production
      - PORT=${PORT:-3001}
      - API_VERSION=${API_VERSION:-1.0.0}
      - APP_NAME=${APP_NAME:-AI Job Suite}
      
      # Database - MongoDB Atlas (External)
      - MONGODB_URI=mongodb+srv://Nkhosingiphile:Bhek%21%21522@cluster0.pmman.mongodb.net/ai-job-suite-prod?retryWrites=true&w=majority
      
      # Redis Cloud (External)
      - REDIS_URL=redis://default:kN0SghGrJUvIxVXJVLsiccsNPqn264ng@redis-16093.c281.us-east-1-2.ec2.redns.redis-cloud.com:16093
      
      # URLs - Production Domains
      - FRONTEND_URL=https://airesumesuite.web.app
      - BACKEND_URL=https://airesumesuite.onrender.com
      - ALLOWED_ORIGINS=https://airesumesuite.web.app,https://airesumesuite.onrender.com
      
      # JWT Authentication
      - JWT_SECRET=ed23f5a6a74ed9bcb0e38c5d3f4298a89176cb750e198e6e1e470ad9246b95b2076f60f222e62b3e1de7f3a1dfc6780b6bfb4c94930ddc9d89aee6c64b76e731
      - JWT_REFRESH_SECRET=7c9a3e1b5cf90241bc0a38ccf402cde8eaab0a23a1e4dff4a493ee9b56ad9bacee204d2ef0f36e85b03c85e5c98288933c730e53f1cfd7e2ab3656e58bdfcf3d
      - JWT_ACCESS_EXPIRES_IN=15m
      - JWT_REFRESH_EXPIRES_IN=7d
      
      # Email Configuration
      - SMTP_HOST=smtp.gmail.com
      - SMTP_PORT=587
      - SMTP_SECURE=false
      - SMTP_USER=bntando522@gmail.com
      - SMTP_PASS=fezkessyqtezmwli
      - SMTP_FROM=bntando522@gmail.com
      
      # AI API Keys
      - GEMINI_API_KEY=AIzaSyCtBf6MjCPWkNR560Zlyitq_2cmqWZ3hro
      - OPENAI_API_KEY=${OPENAI_API_KEY:-sk-your-production-openai-api-key}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-your-production-anthropic-api-key}
      
      # Google OAuth
      - GOOGLE_CLIENT_ID=202022666226-ahhpa9jc4e8cka53h0bv52pqs2tpqohn.apps.googleusercontent.com
      - GOOGLE_CLIENT_SECRET=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
      - GOOGLE_CALLBACK_URL=https://airesumesuite.onrender.com/api/v1/auth/google/callback
      
      # reCAPTCHA
      - RECAPTCHA_SITE_KEY=6LfkOJQrAAAAAGfteUzaGCwQihtZoz1O221RSXs1
      - RECAPTCHA_SECRET_KEY=6LfkOJQrAAAAADxZMvomhgtwNB1FmpnyqVKeho9B
      - RECAPTCHA_MIN_SCORE=0.7
      
      # Security
      - SESSION_SECRET=d397bfd0f6e8cf8a0fa4129e51be9463747d1ea3a6c77e03e241e3df71e6e42848d671ffb947db7458d14ce564b3c9c55a86aeb7e5bc4c957e508dc6c43a93a3
      - ADMIN_API_KEY=ad3c4d19ef9f41a582dce3bf164eabfd
      - SERVICE_API_KEY=3a8658a09b68430db2e755d0e9d4bb13
      - ENCRYPTION_KEY=fb82eae9a7f1a62fc1f4e58b3945a7f1ac34b8f72e4f3946f51d3b9b0bdf9a45
      
      # Payment Processing
      - PAYSTACK_SECRET_KEY=sk_test_0a299384fcbc0e19cbb348a2f1d686c63329c1a9
      - PAYSTACK_PUBLISHABLE_KEY=pk_test_40ddd9743e90fcd42000a071259b80713833f6e4
      
      # External APIs
      - IPGEOLOCATION_API_KEY=af4552558b2d471f871ca869d829671b
      - FIXER_API_KEY=d0b9b766de40fbbe55e1e2214e57eb4d
      - CURRENCYAPI_KEY=c299c4db8cd77f8e1c900888c07bc46b7a2b
      
      # Monitoring
      - SENTRY_DSN=https://e5cfaa159c3404393d2aa5ff5ab2d7ad@o4509756801351680.ingest.de.sentry.io/4509756804038736
      - GA_TRACKING_ID=G-Y4CHQRKG7R
      
      # Feature Flags
      - ENABLE_AI_FEATURES=true
      - ENABLE_PAYMENT_PROCESSING=true
      - ENABLE_EMAIL_NOTIFICATIONS=true
      - ENABLE_JOB_SCRAPING=true
      - ENABLE_ANALYTICS=true
      - ENABLE_RECAPTCHA=true
      
      # Production Settings
      - LOG_LEVEL=info
      - ENABLE_REQUEST_LOGGING=false
      - ENABLE_CORS=true
      - TRUST_PROXY=true
      
      # File Upload
      - MAX_FILE_SIZE=10485760
      - UPLOAD_DIR=uploads
      
      # Rate Limiting
      - RATE_LIMIT_WINDOW_MS=900000
      - RATE_LIMIT_MAX_REQUESTS=100
      - SESSION_TIMEOUT=28800000
      
    volumes:
      - backend_uploads:/app/uploads
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3001/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  backend_uploads:
    driver: local