import React, { useState, useRef } from 'react';\nimport { Button } from '../ui/Button';\nimport { \n  Image, Upload, Crop, RotateCw, FlipHorizontal, FlipVertical,\n  Move, Resize, Trash2, Copy, Eye, EyeOff, Layers, Palette\n} from 'lucide-react';\nimport { clsx } from 'clsx';\n\ninterface ImageAnnotation {\n  id: string;\n  src: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  rotation: number;\n  opacity: number;\n  visible: boolean;\n  locked: boolean;\n}\n\ninterface ImageEditorProps {\n  images: ImageAnnotation[];\n  onImageAdd: (image: File) => void;\n  onImageUpdate: (id: string, updates: Partial<ImageAnnotation>) => void;\n  onImageDelete: (id: string) => void;\n  onImageSelect: (id: string) => void;\n  selectedImageId?: string;\n}\n\nexport default function ImageEditor({\n  images,\n  onImageAdd,\n  onImageUpdate,\n  onImageDelete,\n  onImageSelect,\n  selectedImageId\n}: ImageEditorProps) {\n  const [draggedImage, setDraggedImage] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const selectedImage = images.find(img => img.id === selectedImageId);\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      Array.from(files).forEach(file => {\n        if (file.type.startsWith('image/')) {\n          onImageAdd(file);\n        }\n      });\n    }\n  };\n\n  const handleImageTransform = (property: keyof ImageAnnotation, value: any) => {\n    if (selectedImageId) {\n      onImageUpdate(selectedImageId, { [property]: value });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Upload Section */}\n      <div className=\"bg-black/20 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl p-4\">\n        <h3 className=\"text-white font-semibold mb-4 flex items-center gap-2\">\n          <Image size={18} className=\"text-blue-400\" />\n          Images\n        </h3>\n        \n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          multiple\n          accept=\"image/*\"\n          onChange={handleFileUpload}\n          className=\"hidden\"\n        />\n        \n        <Button\n          onClick={() => fileInputRef.current?.click()}\n          variant=\"outline\"\n          className=\"w-full mb-4 border-dashed border-2 border-blue-400/50 hover:border-blue-400 hover:bg-blue-400/10\"\n        >\n          <Upload size={16} />\n          Upload Images\n        </Button>\n        \n        {/* Image List */}\n        <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n          {images.map((img) => (\n            <div\n              key={img.id}\n              onClick={() => onImageSelect(img.id)}\n              className={clsx(\n                'group flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all duration-300',\n                selectedImageId === img.id\n                  ? 'bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border border-blue-400/50'\n                  : 'bg-white/5 hover:bg-white/10 border border-white/10'\n              )}\n            >\n              <div className=\"relative\">\n                <img\n                  src={img.src}\n                  alt=\"Annotation\"\n                  className=\"w-12 h-12 object-cover rounded-lg\"\n                />\n                {!img.visible && (\n                  <div className=\"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center\">\n                    <EyeOff size={12} className=\"text-white\" />\n                  </div>\n                )}\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-white text-sm font-medium\">Image {img.id}</p>\n                <p className=\"text-gray-400 text-xs\">\n                  {img.width}x{img.height} • {img.opacity * 100}%\n                </p>\n              </div>\n              <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onImageUpdate(img.id, { visible: !img.visible });\n                  }}\n                  className=\"p-1 bg-white/10 hover:bg-white/20 rounded transition-colors\"\n                >\n                  {img.visible ? <Eye size={12} /> : <EyeOff size={12} />}\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onImageDelete(img.id);\n                  }}\n                  className=\"p-1 bg-red-500/20 hover:bg-red-500/30 rounded transition-colors\"\n                >\n                  <Trash2 size={12} className=\"text-red-400\" />\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Image Properties */}\n      {selectedImage && (\n        <div className=\"bg-black/20 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl p-4\">\n          <h3 className=\"text-white font-semibold mb-4 flex items-center gap-2\">\n            <Layers size={18} className=\"text-cyan-400\" />\n            Transform\n          </h3>\n          \n          {/* Transform Controls */}\n          <div className=\"space-y-4\">\n            {/* Position */}\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div>\n                <label className=\"text-sm text-gray-300 mb-1 block\">X Position</label>\n                <input\n                  type=\"number\"\n                  value={selectedImage.x}\n                  onChange={(e) => handleImageTransform('x', parseInt(e.target.value))}\n                  className=\"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm text-gray-300 mb-1 block\">Y Position</label>\n                <input\n                  type=\"number\"\n                  value={selectedImage.y}\n                  onChange={(e) => handleImageTransform('y', parseInt(e.target.value))}\n                  className=\"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500\"\n                />\n              </div>\n            </div>\n            \n            {/* Size */}\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div>\n                <label className=\"text-sm text-gray-300 mb-1 block\">Width</label>\n                <input\n                  type=\"number\"\n                  value={selectedImage.width}\n                  onChange={(e) => handleImageTransform('width', parseInt(e.target.value))}\n                  className=\"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm text-gray-300 mb-1 block\">Height</label>\n                <input\n                  type=\"number\"\n                  value={selectedImage.height}\n                  onChange={(e) => handleImageTransform('height', parseInt(e.target.value))}\n                  className=\"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500\"\n                />\n              </div>\n            </div>\n            \n            {/* Rotation */}\n            <div>\n              <label className=\"text-sm text-gray-300 mb-2 block\">Rotation</label>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"360\"\n                  value={selectedImage.rotation}\n                  onChange={(e) => handleImageTransform('rotation', parseInt(e.target.value))}\n                  className=\"flex-1 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer\"\n                />\n                <span className=\"text-white font-medium min-w-[50px] text-center\">\n                  {selectedImage.rotation}°\n                </span>\n              </div>\n            </div>\n            \n            {/* Opacity */}\n            <div>\n              <label className=\"text-sm text-gray-300 mb-2 block\">Opacity</label>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.1\"\n                  value={selectedImage.opacity}\n                  onChange={(e) => handleImageTransform('opacity', parseFloat(e.target.value))}\n                  className=\"flex-1 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer\"\n                />\n                <span className=\"text-white font-medium min-w-[50px] text-center\">\n                  {Math.round(selectedImage.opacity * 100)}%\n                </span>\n              </div>\n            </div>\n          </div>\n          \n          {/* Quick Actions */}\n          <div className=\"mt-6 pt-4 border-t border-white/10\">\n            <div className=\"flex flex-wrap gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => handleImageTransform('rotation', selectedImage.rotation + 90)}\n              >\n                <RotateCw size={14} />\n                Rotate 90°\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => {\n                  // Flip horizontally by scaling x by -1\n                  // This would need additional transform properties in the interface\n                }}\n              >\n                <FlipHorizontal size={14} />\n                Flip H\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => {\n                  // Flip vertically by scaling y by -1\n                  // This would need additional transform properties in the interface\n                }}\n              >\n                <FlipVertical size={14} />\n                Flip V\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => {\n                  // Duplicate image\n                  const newImage = {\n                    ...selectedImage,\n                    id: `${selectedImage.id}_copy`,\n                    x: selectedImage.x + 20,\n                    y: selectedImage.y + 20\n                  };\n                  // This would need to be handled by parent component\n                }}\n              >\n                <Copy size={14} />\n                Duplicate\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Image Filters */}\n      {selectedImage && (\n        <div className=\"bg-black/20 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl p-4\">\n          <h3 className=\"text-white font-semibold mb-4 flex items-center gap-2\">\n            <Palette size={18} className=\"text-pink-400\" />\n            Filters & Effects\n          </h3>\n          \n          <div className=\"grid grid-cols-2 gap-3\">\n            <Button size=\"sm\" variant=\"outline\" className=\"text-left\">\n              Grayscale\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" className=\"text-left\">\n              Sepia\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" className=\"text-left\">\n              Blur\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" className=\"text-left\">\n              Brightness\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" className=\"text-left\">\n              Contrast\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" className=\"text-left\">\n              Invert\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}